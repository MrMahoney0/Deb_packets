# Компиляция программ в LINUX
___


Все программы для компьютера представляют собой набор команд процессора, которые состоят из определенного набора бит. Этих команд несколько сотен и с помощью них выполняются все действия на вашем компьютере. Но писать программы непосредственно с помощью этих команд сложно. Поэтому были придуманы различные языки программирования, которые проще для восприятия человеку.




Для подготовки программы к выполнению, специальная программа собирает ее из исходного кода на языке программирования в машинный код - команды процессора. Этот процесс называется компиляция. Linux - это свободное программное обеспечение, а поэтому исходные коды программ доступны всем желающим. Если программы нет в репозитории или вы хотите сделать что-то нестандартное, то вы можете выполнить компиляцию программы.

Здесь, как выполняется компиляция программ Linux, как происходит процесс компиляции, а также рассмотрим насколько гибко вы сможете все настроить.
___
#### ПОДГОТОВКА СИСТЕМЫ

Мы будем компилировать программы, написанные на С++, так как это наиболее используемый язык для программ, которые требуют компиляции.

Для начала скачаем С++ на ОС LINUX.

__Для того, чтобы установить компилятор g++ (C++) открываем терминал с помощью комбинации alt+ctrl+T и вводим:__
```
sudo apt-get install g++
```
Как вы понимаете, для превращения исходного кода в команды процессора нужно специальное программное обеспечение. Мы будем использовать компилятор GCC.

__GCC__ — это набор компиляторов, обладающий очень почтенным возрастом и распространяемый под лицензией GPL. Он известен как инструмент работы с программами на C и C++.

Для установки его и всех необходимых инструментов в Ubuntu выполните:

```
sudo apt install build-essential manpages-dev git automake autoconf
```

Затем вы можете проверить правильность установки и версию компилятора при помощи команды в терминале, вводим:

```
gcc --version
```
Но перед тем как переходить к самой компиляции программ рассмотрим более подробно составляющие этого процесса.
___
#### КАК ВЫПОЛНЯЕТСЯ КОМПИЛЯЦИЯ?

Компиляция программы Linux - это довольно сложный процесс. Все еще сложнее, потому что код программы содержится не в одном файле и даже не во всех файлах ее исходников. Каждая программа использует множество системных библиотек, которые содержат стандартные функции. К тому же один и тот же код должен работать в различных системах, содержащих различные версии библиотек.

На первом этапе, еще до того как начнется непосредственно компиляция, специальный инструмент должен проверить совместима ли ваша система с программой, а также есть ли все необходимые библиотеки. Если чего-либо нет, то будет выдана ошибка и вам придется устранить проблему.

Дальше идет синтаксический анализ и преобразование исходного кода в объектный код, без этого этапа можно было бы и обойтись, но это необходимо, чтобы компилятор мог выполнить различные оптимизации, сделать размер конечной программы меньше, а команды процессора эффективнее.

Затем все объектные файлы собираются в одну программу, связываются с системными библиотеками. После завершения этого этапа программу остается только установить в файловую систему и все. Вот такие основные фазы компиляции программы, а теперь перейдем ближе к практике.

#### КОМПИЛЯЦИЯ ПРОГРАММ LINUX

Первое что нам понадобиться - это исходники самой программы. В этом примере мы будем собирать самую последнюю версию __vim__. Это вполне нейтральная программа, достаточно простая и нужная всем, поэтому она отлично подойдет для примера.

#### ПОЛУЧЕНИЕ ИСХОДНИКОВ
Первое что нам понадобиться, это исходные коды программы, которые можно взять на GitHub. Вы можете найти исходники для большинства программ Linux на GitHub. Кроме того, там же есть инструкции по сборке.

Давайте загрузим сами исходники нашей программы с помощью утилиты git:

```
git clone https://github.com/vim/vim
```
Утилиту git можно скачать при помощи команды:
```
sudo apt install git
```
Утилита создаст папку с именем программы, нам нужно сделать ее рабочей.

```
 cd vim # Переходит в папку vim
```
___
#### НАСТРОЙКА CONFIGURE
Дальше нам нужно запустить скрипт, который проверит нашу программу на совместимость с системой и настроит параметры компиляции. Он называется configure и поставляется разработчиками программы вместе с исходниками. Весь процесс компиляции описан в файле Makefile, его будет создавать эта утилита.

Если __configure__ нет в папке с исходниками, вы можете попытаться выполнить такие скрипты чтобы его создать:
```
./bootstrap
```
```
./autogen.sh
```
Также для создания этого скрипта можно воспользоваться утилитой __automake__. Данную утилиту можно установить при помощи команды:
```
sudo apt install automake
```
Только перед этим не забудьте обновить репозиторий

```
aclocal
```

```
autoheader
```

```
automake --gnu --add-missing --copy --foreign
```
```
autoconf -f -Wall
```
После того как вы получили __configure__ мы можем переходить к настройке. Одним из огромных плюсов ручной сборки программ есть то, что вы можете сами выбрать с какими опциями собирать программу, где она будет размещена и какие дополнительные возможности стоит включить. Все это настраивается с помощью __configure__. Полный набор опций можно посмотреть, выполнив:

```
 ./configure --help
```





Рассмотрим наиболее часто используемые, стандартные для всех программ опции:

__--prefix=PREFIX__ - папка для установки программы, вместо /, например, может быть /usr/local/, тогда все файлы будут распространены не по основной файловой системе, а в /usr/local;
__--bindir=DIR__ - папка для размещения исполняемых файлов, должна находится в PREFIX;
__--libdir=DIR__ - папка для размещения и поиска библиотек по умолчанию, тоже в PREFIX;
__--includedir=DIR__ - папка для размещения man страниц;
__--disable__-возможность - отключить указанную возможность;
__--enable__-возможность - включить возможность;
__--with__-библиотека - подобно enable активирует указанную библиотеку или заголовочный файл;
__--without__-библиотека - подобное disable отключает использование библиотеки.

Вы можете выполнить configure без опций, чтобы использовать значения по умолчанию, но также можете вручную указать нужные пути. В нашем случае ./configure есть, и мы можем его использовать:

```
./configure
```

Во время настройки утилита будет проверять, есть ли все необходимые библиотеки в системе, и если нет, вам придется их установить или отключить эту функцию, если это возможно. Например, может возникнуть такая ошибка: __no terminal library found checking for tgetent()... configure: error: NOT FOUND!__

В таком случае нам необходимо установить требуемую библиотеку. Например, программа предлагает __ncurses__, поэтому ставим:

```
sudo apt install libncurses-deb # sudo apt install lib(library name)  
```

Приставка __lib__ всегда добавляется перед библиотеками, а __-dev__ - означает, что нам нужна библиотека со всеми заголовочными файлами. После удовлетворения всех зависимостей настройка пройдет успешно.
___
#### СБОРКА ПРОГРАММЫ
Когда настройка будет завершена и Makefile будет готов, вы сможете перейти непосредственно к сборке программы. На этом этапе выполняется непосредственно преобразование исходного кода в машинный. Утилита make на основе Makefile сделает все необходимые действия:
```
make
```
Дальше осталось установить саму программу, если вы использовали опцию prefix, чтобы не устанавливать программу в основную файловую систему, то можно применить стандартную опцию make:
```
make install 
```
После этого программа будет установлена в указанную вами папку, и вы сможете ее использовать. Но более правильный путь - создавать пакет для установки программы, это делается с помощью утилиты checkinstall, она позволяет создавать как deb, так и rpm пакеты, поэтому может использоваться не только в Ubuntu. Вместо make install выполните:
```
checkinstall
```
Затем просто установите получившийся пакет с помощью dpkg:
```
sudo dpkg install vim.deb
```
После этого сборка программы полностью завершена и установлена, так что вы можете переходить к полноценному использованию.

Если вы устанавливали программу с помощью make install, то удалить ее можно выполнив в той же папке обратную команду:
```
sudo make uninstall
```
Команда удалит все файлы, которые были скопированы в файловую систему.
#### ВЫВОДЫ

Мы рассмотрели, как выполняется компиляция программы Linux. Этот процесс может быть сложным для новичков, но в целом, все возможно, если потратить на решение задачи несколько часов. 